<!DOCTYPE html><html th:replace="~{layout/base :: base(~{fragments/headerItems :: home}, ~{::div})}" xmlns:th="http://www.thymeleaf.org">

<div class="container"><br>
    <h3>ìµœê·¼ ì¸ê¸°ê¸€</h3><br>
    <ul class="list-group tab-pane fade show active tabCon" id="home" role="tabpanel" aria-labelledby="home-tab">
        <div class="post-item" th:each="post : ${recentPopularPosts}">
            <li class="list-group-item" th:onclick="|location.href='@{/posts/{postId}(postId=${post.id})}'|">
                <div class="row">
                    <div class="col-1">
                        <img th:src="@{images/{name}(name=post1.jpg)}" width="70px" height="85px">
                    </div>
                    <div class="col">
                        <h5 th:text="${post.title}">ì œëª©</h5>
                        <p th:text="${post.content}">ë‚´ìš©</p>
                    </div>
                    <div class="col-2">
                        <h6 class="text-end" th:text="|${post.address.sido} ${post.address.sgg}|">ì‹œë„ ì‹œêµ°êµ¬</h6><br>
                        <p class="text-end" th:text="|ğŸ‘${post.recommend}|"></p>
                        <p class="text-end" th:text="|${post.quantity}ê°œ ë‚¨ìŒ|"></p>
                    </div>
                </div>
            </li>
        </div>
    </ul><br><br>

    <h3>ë‚´ ì£¼ë³€ ë³´ê¸°</h3>
    <th:block th:if="${member} != null"><input type="hidden" id="memberDoro" th:value="${member.address.doro}" readonly></th:block>
    <div class="d-flex justify-content-center">
        <div id="map" style="width: 600px; height: 500px; border: 2px solid green"></div>
        <script type="text/javascript" src="//dapi.kakao.com/v2/maps/sdk.js?appkey=f1ad9b5adce2cf7e772b667dde656195&libraries=services,clusterer"></script>
        <script type="text/javascript" th:inline="javascript">
            // ì£¼ì†Œ-ì¢Œí‘œ ë³€í™˜ ê°ì²´ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
            var geocoder = new kakao.maps.services.Geocoder();

            var map = new kakao.maps.Map(document.getElementById('map'), {
                center: new kakao.maps.LatLng(36.38, 127.51),
                level : 13
            });

            var posts = [[${nearPosts}]];

            // ë§ˆì»¤ í´ëŸ¬ìŠ¤í„°ëŸ¬ë¥¼ ìƒì„±í•©ë‹ˆë‹¤
            var clusterer = new kakao.maps.MarkerClusterer({
                map: map, // ë§ˆì»¤ë“¤ì„ í´ëŸ¬ìŠ¤í„°ë¡œ ê´€ë¦¬í•˜ê³  í‘œì‹œí•  ì§€ë„ ê°ì²´
                averageCenter: true, // í´ëŸ¬ìŠ¤í„°ì— í¬í•¨ëœ ë§ˆì»¤ë“¤ì˜ í‰ê·  ìœ„ì¹˜ë¥¼ í´ëŸ¬ìŠ¤í„° ë§ˆì»¤ ìœ„ì¹˜ë¡œ ì„¤ì •
                minLevel: 10 // í´ëŸ¬ìŠ¤í„° í•  ìµœì†Œ ì§€ë„ ë ˆë²¨
            });

            var markers = posts.map(function(data) {

                geocoder.addressSearch(data.doro, function(result, status) {
                    if(status === kakao.maps.services.Status.OK) {

                        var coords = new kakao.maps.LatLng(result[0].y, result[0].x);

                        map.setCenter(coords);
                        map.setLevel(7);

                        var marker = new kakao.maps.Marker({
                            map: map,
                            clickable: true,
                            position: coords
                        });

                        var postId = data.Id;
                        var title = data.title;
                        var iwContent =
                            `<div style="
                                padding:5px;
                                display: inline-block;
                                width: 200px;
                                white-space: nowrap;
                                overflow: hidden;
                                text-overflow: ellipsis;">
                                    <a href="/posts/${postId}" target="_blank">${title}</a>
                            </div>`;
                        var infowindow = new kakao.maps.InfoWindow({
                            position : coords,
                            content : iwContent,
                            removable : true
                        });

                        kakao.maps.event.addListener(marker, 'click', function() {
                              infowindow.open(map, marker); // ë§ˆì»¤ ìœ„ì— ì¸í¬ìœˆë„ìš°ë¥¼ í‘œì‹œí•©ë‹ˆë‹¤
                        });

                        clusterer.addMarker(marker);
                    }
                });
            });

        </script>
    </div><br><br>

    <script type="text/javascript" th:src="@{/js/home/selectBoxes.js}"></script>
</div>
</html>